# Operation test
こちらはsekimenの動作テスト用の資料です。

ファームウェア書込み環境を構築し、キーボードの動作を確認するまでの手順が記載されています。

本手順はWindows(厳密にはWindows10)にてキャラクタユーザインターフェース用のソフトウェアであるMSYS2を使用する場合を基準にしています。

キーボード組立中や、キーボード組立後の動作確認にご活用ください。

# ファームウェアの書込み環境の構築

ファームウェア書込み環境構築のため、QMK FirmwareのこちらのWeb ページ

https://docs.qmk.fm/#/ja/newbs_getting_started

を参考に、MSYS2及びgitをインストールします。

また、こちらのURL等も参考になるかと思います。(ページの作成者様にこの場を借りて感謝致します。)

https://qiita.com/cactusman/items/ac41993d1682c6d8a12e

インストール後、PC上に任意の名前のフォルダを一つ作成します。(出来れば英語のファイル名が良いです。github_workとか)

<img width="155" alt="フォルダ" src="https://user-images.githubusercontent.com/54104281/88303108-94214c80-cd41-11ea-957e-8696f901dc56.png">

フォルダ作成後、フォルダの上にマウスカーソルを移動して右クリックします。その後「プロパティ」をクリックします。

クリック後、表示されたダイアログにて、画像の赤枠で囲んだ部分のパスを確認しておきます。

<img width="300" alt="フォルダのパス" src="https://user-images.githubusercontent.com/54104281/88304171-e3b44800-cd42-11ea-993a-4b857d0bba86.png">

その後、MSYS2等を起動します。

起動後、次のコマンドを入力し、Enterキーを押します。

cd コピーしたフォルダのパス(ただし￥は/に置き換えます。)

先ほど作成したフォルダの中へ移動できます。
赤枠の部分がフォルダのパスと一致していればOKです。

<img width="455" alt="フォルダ移動後" src="https://user-images.githubusercontent.com/54104281/88305963-18c19a00-cd45-11ea-8134-c1be2137aa82.png">

移動後、以下のコマンドを入力し、Enterキーを押します。

git clone --recurse-submodules https://github.com/qmk/qmk_firmware.git

ファームウェア書込みに使用するフォルダが現在のフォルダにコピーされます。

(注意：現時点ではsekimenのファームウェアはこのフォルダの中にはありません。現在追加作業中です。)

その後、以下のコマンドを入力し、Enterキーを押します。

cd qmk_firmware

すると、ファームウェア書込みを行うフォルダの中へ移動されます。

移動が完了したら、左右いずれかのpro_mircroの取付けまで完了したキーボードのpro_microとPC間をUSBケーブル(通信可能なもの)で接続します。

接続後、以下のコマンドを入力し、Enterキーを押します。

make sekimen:default:avrdude

(自分用のメモ：githubに置くファームウェアのデフォルトは5列タイプにしておく。ビルドガイドの拡張基板組立の記述にファームウェアの記述を7列に変更する記述を追加する。
 組立が終われば自然に知識が増えるようにしたい。)

すると、ファームウェアの書込みが開始されます。

ファームウェアの書込み開始後しばらくすると、画像のような状態になります。

(リセット待機中の画像または埋め込み)

その状態で、ピンセット等でキーボードのリセットスイッチを押します。

(リセットスイッチを押している画像)

そうすると画面の状態が変わります。

画像のようなが表示されたら、ファームウェアの書込みは完了です。

(ファームウェアの書込み完了後の画像または埋め込み)

もう片方のキーボードに対しても同様の手順でファームウェアを書き込みます。

#　左右のキーボードのTRRSケーブルでの接続

左右のキーボードのTRRSジャック間をTRRSケーブルで接続します。

TRRSケーブルは奥まで差し込んでください。

(左右キーボードのTRRSケーブル接続時の画像。ケーブル部分が映っていればいい。完成したキーボードでもOK)

#　左キーボードのpro_microとPC間をUSBケーブルで接続

左キーボードのpro_microとPC間をUSBケーブルで接続します。

#　キーの入力テスト

PCとキーボードを接続した状態で、メモ帳等の文字入力用ソフトウェアを起動し、文字入力が可能な状態にしておきます。

またはキーボードテスター様のサイト

https://www.keyboardtester.com/tester.html

を表示します。

その後、画像のようにピンセットやスイッチを押した状態のキースイッチ等で、基板のキースイッチはんだ付け用の端子間をショートさせます。(キースイッチが実装されている場合はキーを押します。)

![入力動作確認用](https://user-images.githubusercontent.com/54104281/88373551-ffffc580-cdd2-11ea-85f6-d4032195b3a9.png)

組立が正しく行われていれば、ショートさせた箇所に対応する文字が入力されます。

これを左右基板の各端子、もしくはキースイッチに対して行います。

キーの入力に問題が無ければ、動作テストは完了です。
